from flask import Flask, request, Response, jsonify
import os
import uuid

app = Flask(__name__)


@app.route('/generate_trip', methods=['POST'])
def generate_trip():
    try:
        # 获取表单数据
        destination = request.form.get('destination')
        season = request.form.get('room')
        weather = request.form.get('adult')
        start_time = request.form.get('check-in')
        end_time = request.form.get('check-out')

        # 定义推荐信息和图片链接
        if destination == '上饶' and season == '春季' and weather == '晴天':
            recommended_place = '婺源'
            scenic_features = '<br>春天的婺源是一幅被金色油菜花与粉墙黛瓦浸润的诗意画卷。当春风掠过江南丘陵，江岭的万亩梯田率先被染成金色的海洋 —— 层层叠叠的花浪顺着山势起伏，如金色绸带缠绕山间，山脚下错落的徽派村落被花海簇拥，白墙黑瓦在阳光下泛着温润的光泽，飞檐翘角间点缀着几簇新绿的竹枝，宛如陶渊明笔下的世外桃源。\n篁岭古村在春日里更是独具韵味。数百栋明清古宅依山而建，层层叠叠的梯田从村口蔓延至山巅，油菜花盛开时，整个村落仿佛悬浮在金色云霞之上。漫步于青石板路，可见家家户户的竹匾里晒着新收的春茶，窗台上摆放着刚采摘的野花，不经意间转角，便会遇见一丛从石墙缝里探出头的油菜花，或是一条被落花覆盖的幽僻小巷。清晨的薄雾尚未散尽时，村落笼罩在朦胧的轻纱中，远处的山峰若隐若现，近处的花海与古建在晨露中泛着微光，宛如一幅水墨丹青在眼前徐徐展开。\n星江河畔的春天则多了几分灵秀。河畔的油菜花沿着河岸肆意生长，倒映在碧绿的河水中，形成 “河有万湾多碧水，田无一垛不黄花” 的盛景。撑一艘竹筏顺流而下，两岸的花影与天光云影共徘徊，偶有几只白鹭掠过水面，惊起涟漪阵阵。黄昏时分，夕阳的余晖为花海镀上一层金边，归巢的鸟儿掠过村落上空，农舍的烟囱里升起袅袅炊烟，空气中弥漫着油菜花的清香与泥土的芬芳，让人沉醉在这静谧而绚烂的春日时光里。'
            food_recommendations = '<br>1. 糊豆腐 —— 将嫩豆腐切成小块，佐以笋丁、香菇、肉末入锅炖煮，待汤汁浓稠时勾薄芡，起锅前撒一把翠绿葱花。豆腐煮至外皮微皱却内里嫩滑，吸饱了菌菇的鲜香与肉末的醇厚，筷子轻夹便在勺中颤巍巍地晃动。<br>2. 粉蒸肉 —— 婺源的粉蒸肉讲究 “肥而不腻，糯而清香”。精选肥瘦相间的五花肉切大块，用酱油、料酒、姜末腌渍入味后，裹上炒至金黄的米粉，码入竹蒸笼中大火蒸制。米粉吸收了肉汁的油脂变得油润透亮，五花肉酥烂得轻轻一抿就化在口中，咸香中带着稻米的焦香<br>3. 蒸汽糕 —— 清晨的婺源街巷，总能遇见卖蒸汽糕的小摊。米粉加水调成米糊，倒入铺着纱布的木蒸笼，撒上桂花、白糖或豆沙，旺火蒸至蓬松。刚出锅的蒸汽糕白如云朵，用刀切成菱形小块，咬一口，绵密松软中带着桂花的清甜，或是豆沙的细腻绵柔，湿润的口感带着微微的发酵香气。<br>4. 酒糟鱼 —— 将鲜鱼剖洗净后切块，用盐、香料腌制去腥，再裹上自家酿的糯米酒糟，装入坛中密封月余。启坛时，酒香与鱼鲜扑面而来，鱼肉经酒糟浸润后紧实有嚼劲，咸鲜中带着糯米的微甜和酒曲的醇香，细细咀嚼，仿佛能尝出时光沉淀的韵味。<br>5. 清明果 —— 清明果的外皮软糯中带着艾草的清香，咬开后，咸香的内馅与清新的草香在口中交融，仿佛把整个春天的生机都吃进了肚里。清明时节祭祖后分食清明果的习俗，更让这道点心成为了追思与新生交织的味觉符号。<br>6. 醋果子炒鸡 —— 醋果子是婺源独有的酸腌菜，用本地辣椒、生姜、糯米等发酵制成，酸香中带着微辣。将土鸡切成小块爆炒至金黄，加入醋果子、蒜末、干辣椒同炒，醋果子的酸香彻底激发了鸡肉的鲜嫩，辣意层层递进，酸、辣、鲜、香在锅中碰撞出热烈的火花。'
            warm_tips = '<br>1.春季婺源气候较为温和，但早晚温差较大，可准备长袖衬衫、薄外套，还需携带雨具。<br>2.婺源景区分布较广，景区之间的距离较远。可以选择包车、乘坐公共交通或参加旅行团等方式前往各景区。包车相对比较方便，但费用较高；公共交通较为实惠，但车次可能较少，需要合理安排时间。'
            # conclusion = '更多详情资讯请返回网页'
            # 替换为本地图片路径并调整格式
            image_url = "https://ts1.tc.mm.bing.net/th/id/R-C.2f0964fdbd615edf04340f0da76d0c57?rik=SQpxw9hOsnoRCw&riu=http%3a%2f%2fwww.jxwuyuan.com%2fuploads%2fallimg%2f190225%2f1-1Z225210Q1G2.jpg&ehk=6oc6DuxKrXAxfeY1PjTobcog4qDKO7FJSlDn1rZrCwc%3d&risl=&pid=ImgRaw&r=0"
        elif destination == '南昌' and season == '夏季' and weather == '晴天':
            recommended_place = '滕王阁、八一广场、江西博物馆、江西省美术馆、鄱阳湖'
            scenic_features = '<br><strong>滕王阁：</strong>位于江西省南昌市东湖区，地处赣江东岸，为南昌市地标性建筑、豫章古文明之象征，与湖南岳阳岳阳楼、湖北武汉黄鹤楼并称为 “江南三大名楼”。<br><strong>八一广场：</strong>位于江西省南昌市东湖区，是南昌市的心脏地带，江西省最大的城市中心广场，也是全国红色旅游经典景区之一。八一广场原名人民广场，是为纪念南昌起义而建立。广场上矗立着八一南昌起义纪念塔，它是广场的标志性建筑，高45.5米，由塔基、塔座、塔身、塔顶四部分组成。塔身正面镌刻着叶剑英元帅题写的 “八一南昌起义纪念塔” 九个铜胎鎏金大字，背面是 “八一南昌起义简介” 花岗石碑文。<br>江西博物馆坐落在南昌市赣江、抚河环抱的新洲上，是一座大型综合性博物馆，集文物征集、收藏、研究、展示、教育、服务于一体。<br><strong>江西省美术馆：</strong>是江西省唯一的国家重点美术馆，位于南昌市红谷滩区赣江南大道2688号，集展览、收藏、研究、教育、交流、服务于一体。<br><strong>鄱阳湖：</strong>位于江西省北部，地处九江、南昌、上饶三市，是中国第一大淡水湖，也是中国第二大湖，仅次于青海湖,鄱阳湖在夏季水丰草美，是观鸟、赏湖景的好时节。湖面波光粼粼，水天一色，不时有候鸟飞过，形成一幅美丽的自然画卷。<br>'
            food_recommendations = '<br>1. 藜蒿炒腊肉 —— 这道菜的精髓在于 “以素托荤”—— 将藜蒿掐成寸段，只取最嫩的部分，与切成薄片的陈年腊肉同炒。腊肉的油香在锅中滋滋散开，逼出咸香的油脂，此时倒入藜蒿急火快炒，青嫩的茎秆瞬间染上油光，却仍保持着脆嫩的口感。藜蒿的清香消解了腊肉的咸腻，腊肉的醇厚又为藜蒿增添了层次，二者在锅中相遇，恰似赣江的灵秀与老城的烟火气握手言欢。这道菜常出现在南昌人春日的饭桌上，配一碗白米饭，便能让人嚼出 “蒌蒿满地芦芽短” 的诗意。<br>2. 瓦罐汤 —— 南昌的瓦罐汤是市井街巷里的温暖符号。大大小小的瓦罐整齐码放在炭火灶上，汤料以瓷勺舀入带盖的小瓦罐，注入清水后用锡纸密封，再埋入热灰中慢煨数小时。最经典的排骨莲藕汤，选洪湖粉藕切块，与排骨同煨，藕香与肉香在瓦罐中慢慢交融，汤汁浓稠如乳，喝时撒少许胡椒粉，醇厚的鲜味里透着莲藕的清甜。夏日里的冬瓜薏米汤则是解暑妙品，冬瓜的清爽与薏米的甘淡经慢火淬炼，喝起来沁人心脾，仿佛给燥热的身心浇了一捧凉水。瓦罐汤讲究 “一汤一罐”，火候足时滋味妙，就像南昌人过日子，不急不躁，却自有一份从容的讲究。<br>3. 南昌炒粉 —— 南昌炒粉的灵魂在 “镬气”。早年间，街头巷尾的炒粉摊前，摊主手持长筷在大铁锅中翻飞，火苗舔着锅底，粉干在热油中滋滋作响。精选的江西米粉提前泡发至柔韧，先爆香蒜末、辣椒，再加入豆芽、青菜、猪肉丝或牛肉丝翻炒，最后倒入米粉快速颠炒，让每一根粉都裹上油润的光泽。火候到位的炒粉，粉干根根分明、口感劲道，配菜的鲜香与酱油的焦香渗透其中，吃时再浇一勺红彤彤的油泼辣子，辣得人额头微汗，却停不下筷子。这道菜是南昌人的 “万能餐”—— 早餐来一盘配瓦罐汤，开启元气满满的一天；夜宵摊前，加个鸡蛋或火腿肠，便是深夜慰藉肠胃的最佳选择。镬气腾腾的炒粉摊，见证了南昌人从晨光熹微到夜色阑珊的日常，也藏着这座城市热烈鲜活的市井底色。<br>'
            warm_tips = '<br>1. 夏季南昌气温较高，注意做好防暑降温措施，准备清凉油、藿香正气水等防暑药品，预防中暑。同时，随身携带足量饮用水，及时补充水分，避免在烈日下长时间暴晒。<br>2. 博物馆免费开放，但需提前预约。禁止携带宠物、气球、滑板车、危险物品等入馆。美术馆常年免费参观，开放时间为9:00 - 17:00（16:30停止入馆），每周一闭馆（法定节假日除外）。<br>3.鄱阳湖水域广阔，夏季水位变化较大，在湖边游玩时务必注意安全，严禁私自下水游泳，不要在没有安全防护设施和救援人员的水域进行涉水活动。尤其是携带儿童的游客，要时刻看管好小孩，避免发生溺水事故。'
            image_url = "https://p1.ssl.qhmsg.com/t012115c5f46ad705ba.jpg"  # 替换为合适的南昌夏季图片链接
        elif destination == '宜春' and season == '夏季' and weather == '晴天':
            recommended_place = '万载古城'
            scenic_features = '<br><strong>简介：</strong><br>夏天的万载古城，古建筑群成为天然的避暑胜地。古祠堂、古民居的青瓦屋顶和厚实墙壁，能有效阻挡外界热气，内部空间阴凉舒适。游客可以在古祠堂内欣赏精美的木雕、石雕、灰塑和彩绘，感受古建筑的艺术魅力，同时享受夏日的清凉。古城内的园林景观在夏天焕发出勃勃生机，绿树成荫，花草繁茂。池塘里荷花盛开，荷叶田田，为古城增添了一抹清新的夏日色彩，构成了一幅幅美丽的夏日画卷，让游客仿佛置身于江南水乡之中。万载县首创了 “烟花 + 古城” 融合发展模式，坚持每周六和法定节假日晚8点常态化开展焰火表演，夏天的夜晚，当烟花在古城上空绽放，五彩斑斓的光芒映照在古老的城墙上，与古建筑的飞檐翘角相互辉映，形成了一种古今交融的独特美景，让人陶醉其中。夏天的夜晚，万载古城的灯光亮起，暖黄色的灯光映照在青石板路上，营造出温馨而浪漫的氛围。古祠堂、古街道和巷弄在灯光的勾勒下，展现出独特的轮廓和线条，让古城的夜晚充满了诗意和韵味。滨水区域会举办水幕灯光秀，利用现代灯光技术和水幕特效，打造出奇幻的光影世界。水幕上投射出各种图案和影像，与周围的古建筑、水景相融合，为游客带来一场美轮美奂的视觉盛宴<br><strong>非遗展示：</strong><br>1.夏布织造技艺 —— 夏布文化馆内文创产品精美，可亲手体验织布过程，感受千年布艺传承的魅力。<br>2.万载开口傩 —— 演员戴神秘面具，身着艳丽服饰，边唱边跳演绎古老传说，在古祠堂前表演，粗犷刚劲，尽显民俗文化神秘内涵。<br>3.万载花炮制作技艺 —— 展示精美花炮成品，揭秘复杂制作流程，在安全许可下可体验简易制作，感受 “花炮之乡” 的文化底蕴。<br>4.万载花灯戏 —— 丰富表演形式与生动剧情相结合，于古城戏台上演，为夏日增添精彩的视听盛宴。'
            food_recommendations = '<br>1.万载剁肉 —— 万载剁肉的灵魂藏在 “剁” 字里。精选本地土猪的前腿肉，三分肥七分瘦，刀起刀落间剁成均匀肉末，刀刃与案板碰撞出 “咚咚” 节奏，仿佛为餐桌奏响前奏。佐以本地特产的皱皮辣椒切碎，加入咸香豆豉、蒜末、生抽调味，热油爆香后迅速翻炒，肉末在锅中裹着油光滋滋作响，辣香与肉香瞬间弥漫街巷。<br>2.艾米果 —— 每逢春夏之交，赣鄱大地的田埂上，艾草鲜嫩欲滴，摘来洗净焯水，捣成碧绿的草泥，与糯米粉揉成青团。艾米果的内馅藏着山野智慧：咸馅以笋丁、腊肉、豆干炒香，咸鲜中透着竹林的清鲜；甜馅则用黑芝麻、花生碎拌上蜂蜜，咬开时流露出细密的甜香。包好的艾米果或蒸或煎，蒸制的软糯温润，表皮泛着艾草的油光，咬一口，青草香与米香在舌尖缠绵，内馅的咸甜与外皮的微苦形成奇妙平衡；油煎的则外酥里嫩，边缘微微焦脆，更添一份烟火气。<br>3. 竹筒饭 —— 在古色古香的街巷里，总能遇见背着竹篓卖竹筒饭的手艺人。新鲜毛竹锯成寸段，一端留节作底，填入浸泡过的糯米，再码入腊肉丁、香菇片、玉米粒等食材，加水后用芭蕉叶封口，架在炭火上慢烤。竹节在火中 “滋滋” 冒油，糯米吸收了腊肉的油脂、香菇的鲜香，逐渐变得油润透亮，竹香也顺着热气渗入米粒，形成独特的清香。<br>4.荷花酥 —— 师傅将油酥面团擀成薄如蝉翼的油皮，包裹上莲蓉或豆沙馅，用刀切成均匀的花瓣状，入油炸至花瓣层层绽开，如一朵荷花在油锅中盛开。起锅后撒上少许糖霜，或是点缀一粒枸杞，精致得让人不忍下口。'
            warm_tips = '<br>1.夏季万载气温较高，建议携带防晒霜、遮阳帽、太阳镜、遮阳伞等防晒用品；备好藿香正气水、清凉油等防暑药品，以防中暑；多补充水分，可携带水杯，古城内设有饮水点。<br>2.每周六和法定节假日晚有烟花表演，提前到达观赏区域，占据好位置；夜间观赏时注意保暖，可携带薄外套；结束后跟随人流有序离场，注意交通安全。'
            image_url = "https://p8.itc.cn/q_70/images03/20231029/e9fbef6f152846f69637f57e87996c93.jpeg"
        elif destination == '吉安' and season == '夏季' and weather == '晴天':
            recommended_place = '庐陵文化生态园'
            scenic_features = '<br><strong>简介：</strong><br>夏季的庐陵文化生态园，是一幅自然与人文交融的绝美画卷。步入园区，首先映入眼帘的是山脚下约3.3公顷湿地中盛放的荷花，田田荷叶如绿伞铺展，洁白如雪、粉嫩似霞的荷花点缀其间，与摇曳的芦苇共同勾勒出诗意的湿地风光。园区高达90%以上的绿化率，使得古树、珍稀树种郁郁葱葱，构筑起市中心城区的“绿肺”，漫步其中，阵阵清凉驱散夏日燥热，清新空气沁人心脾。 千亩庐陵湖是生态园的璀璨明珠，阳光洒落，湖面波光粼粼。游客泛舟湖上，青山绿树倒映水中，抬头可见天空云彩与湖面相接，低头能赏玻璃红鲤鱼自在嬉戏；螺子山上万只白鹭栖息，时而展翅高飞，时而掠水而过，为夏日增添灵动气息。 人文景观同样精彩纷呈。以“庐陵文化”为灵魂，庐陵民俗园、文塔和浮雕文化墙等建筑，承载着吉安深厚的民俗、名人、书院与宗教文化，夜晚华灯初上，更显古朴庄重。综合休闲娱乐区的大型音乐喷泉，长200米、宽40米，主喷高达138米，随着音乐节奏，水柱高低起伏，五彩灯光交相辉映，打造震撼的视听盛宴。此外，游乐场内摩天轮缓缓转动、大摆锤惊险刺激，让游客在炎炎夏日尽享欢乐与激情。<br><strong>非遗展示：</strong><br>1.永新盾牌舞 —— 刚勇雄浑，舞者执盾持械，步伐铿锵，呐喊声响彻园区，重现古战场的激烈场景，尽显庐陵人豪迈气魄。<br>2.吉安鲤鱼灯 —— 竹篾为骨，彩纸作衣，内置烛光。夏夜舞动时，鲤鱼灯穿梭游弋，流光溢彩，寓意吉祥，是光影交织的灵动画卷。<br>3.吉安剪纸 —— 红纸翻飞，剪刀游走，花鸟鱼虫、人物故事瞬间成型。游客可现场体验，亲手剪出专属的艺术作品，感受指尖上的非遗魅力。<br>4.庐陵木雕 —— 工匠以刀为笔，在木头上精雕细琢，从简约纹饰到繁复场景，每一刀都展现木雕技艺的细腻精巧，诠释传统工艺之美。<br>5.永新小鼓 —— 国家级非遗，艺人执鼓板、持竹签，边敲边唱，讲述庐陵故事。历史传说、民间趣事融入曲中，带来沉浸式听觉享受。<br>6.吉安采茶戏 —— 曲调悠扬婉转，表演活泼灵动。演员身着艳丽戏服，唱念做打间，将庐陵风情展现得淋漓尽致，极具观赏性。'
            food_recommendations = '<br>1.井冈烟笋炒肉 —— 以山火熏制出独特焦香，泡发后脆嫩如鲜。与肥瘦相间的五花肉同炒，油脂渗透笋丝，咸香中带着山林气息，笋的爽脆与肉的醇厚交融，下饭之余尽是质朴的乡土风味，一口尝尽井冈山的山野灵秀。<br>2.永新血鸭 —— 选本地嫩鸭剁块爆炒，鸭血临起锅前泼入，瞬间凝成紫红油亮的碎末，与辣椒、姜蒜共舞。鸭肉紧实弹牙，鸭血绵软入味，香辣直击味蕾，咸鲜暗藏回甘，暑气中嚼出江湖快意，是永新餐桌上火辣的季节限定。<br>3. 吉安薄酥饼 —— 以精粉制皮，层层叠叠如蝉翼，表面撒满焦香芝麻。烘焙后酥皮簌簌落手，甜咸两种滋味在舌尖交织 —— 糖霜的清甜与椒盐的微咸相得益彰，咬一口脆响清脆，便携易存，无论是配茶还是零嘴，都是穿梭古街时的舌尖慰藉。<br>4.泰和乌鸡汤 —— 以 “白凤” 之姿闻名，入锅慢炖至骨酥肉烂，汤色澄黄透亮，油脂轻浮表面。乌鸡的鲜甜融于汤中，不加过多调料却滋味醇厚，夏季饮之，既能借食材温补身体，又可借汤品润燥消暑，一碗喝出赣地的养生智慧。'
            warm_tips = '<br>1.夏季气温高，园区绿植虽多但仍较晒，建议携带遮阳帽、墨镜、防晒霜，穿轻薄透气的防晒衣；备好藿香正气水等防暑药品，避免长时间暴晒，感到不适及时到阴凉处休息。<br>2.园内植被丰富，蚊虫较多，可提前涂抹驱蚊液，穿长袖长裤；尽量避免进入草丛深处，以防被蜱虫等叮咬。在湖边游玩时，不要靠近深水区。'
            image_url = "https://copyright.bdstatic.com/vcg/edit/3db13b86d9e71f687da9cae984dffd26.jpg@h_1280"
        elif destination == '景德镇' and season == '秋季' and weather == '晴天':
            recommended_place = '中国陶瓷博物馆、陶溪川、御窑博物馆'
            scenic_features = '<br><strong>中国陶瓷博物馆：</strong>全称为景德镇中国陶瓷博物馆，是国内首家陶瓷专题博物馆、国家一级博物馆。1953年由郭沫若提议创建，2015年改造后重新开放。馆内藏品超5万件，涵盖新石器时代陶器至现代陶瓷。其常设展厅按历史脉络展示陶瓷发展，还有互动空间。建筑造型仿照龙窑，一层大厅形似窑炉炉膛，各层由长廊连接，艺术感十足。在这里，能系统了解景德镇陶瓷文化发展脉络，领略中国陶瓷艺术的魅力。<br><strong>陶溪川：</strong><br>是集文化创意、休闲、餐饮、娱乐等多功能于一体的大型城市综合体，也是中国首座以陶瓷文化为主体的一站式文化休闲娱乐旅游体验创意园区。它以原宇宙瓷厂为核心启动区，保留了煤烧隧道窑、工业厂房等工业遗产。园区内有各类艺术工作室、陶瓷工业遗产活态博物馆、精品酒店等。夜晚灯光亮起，夜景迷人，还有创意市集，汇聚了众多文创陶瓷作品，是体验景德镇夜生活、感受陶瓷艺术创新活力的好去处。<br><strong>御窑博物馆：</strong>位于景德镇市珠山区，2021年被选为 “文化 - 博物馆” 类别评委奖。博物馆以“窑”的拱形为设计元素，造型独特。这里藏品多为孤品、绝品，被视为研究、鉴赏景德镇瓷器的“天下第一馆”。它依托御窑厂遗址，能让人近距离感受瓷都魅力，傍晚时分，在灯光映照下，博物馆的红色砖瓦和双曲面造型更具韵味，是拍照打卡的热门地点。'
            food_recommendations = '<br>1.碱水粑 —— 这是景德镇经典特色小吃，由大米与碱水蒸制后切片。常见做法是与鸡蛋共炒，金黄与雪白交织，咸香可口，既是菜肴又是主食。若搭配烟熏腊肉炒食，腊肉的醇厚香味融入其中，更是别有一番风味 ，推荐前往小黄鱼・爱厨房、回家吃饭等店铺品尝。<br>2.饺子粑 —— 以大米磨制的米粉作外皮，薄如蝉翼。馅料多为韭菜、豆角、白豆干或竹笋等，清新爽口。可蒸可炸，蒸的口感软糯，能尝到食材本味；炸的外皮酥脆，内里依旧软糯。谭婆饺子粑、抚州弄眼镜粑店都是不错的选择，价格实惠，深受当地人喜爱。<br>3. 冷粉 —— 景德镇传统特色小吃，其粗粉口感Q弹。拌料丰富，有榨菜、腌菜、萝卜干，还有独特的油浸橘皮增香，再加上香辣的辣椒油，吃起来爽辣过瘾，陈皮的香气在口中散开。毛仔特色小吃、壹碗粉等店铺的冷粉都很受欢迎，是体验景德镇美食不可错过的选择。<br>4.油条包麻糍 —— 刚炸好的油条，外皮金黄酥脆，内里柔软有韧劲，散发着浓郁面香。麻糍以优质糯米蒸煮捶打而成，软糯弹牙，带着米香。制作时，将热乎麻糍平铺在油条上，撒满白糖与熟芝麻，白糖遇热微微融化，芝麻香气四溢。对折油条，让麻糍被紧紧包裹，再在芝麻糖里一滚，使其周身沾满香甜。'
            warm_tips = '<br>1.景德镇面积不大，打车较为便宜、安全且舒适，也可选择租电动车，方便灵活，但驾驶时要注意安全 。<br>2.许多景点需提前预约，如中国陶瓷博物馆提前7天预约，御窑博物馆提前3天预约，务必规划好行程并提前预约，避免耽误游玩。部分市集只在周末开放，像陶溪川集市是周五至周日17:00 - 22:00，乐天集市是周六07:00 - 12:00（门票50元/人 ），要提前了解并合理安排时间。在景区内不要随意触碰展品，参观博物馆、逛陶瓷集市时，遵守相关规定，爱护文物和商品。三宝村、雕塑瓷厂面积较大，做好路线规划，避免走冤枉路，同时注意做好防晒。'
            image_url = "https://img.d-arts.cn/grab_img/5761bae69206a2ac820560cac6f7c4101651742467.jpeg"
        elif destination == '赣州' and season == '春季' and weather == '阴天':
            recommended_place = '峰山国家森林公园'
            scenic_features = '<br><strong>简介：</strong>春天的峰山国家森林公园在阴天时，宛如一幅意境深远的水墨画卷。此时，山间云雾缭绕，云海翻涌变幻，雾气弥漫在茂密的森林间，山峰在云雾中若隐若现，给人以神秘空灵之感，漫步其中仿若踏入梦幻仙境。这里自然景观丰富且独具魅力。公园内野生植物多达218科1116种，森林覆盖率达86.7%，春天的植被愈发繁茂，绿树翠竹生机勃勃，草木清香沁人心脾。滴水寨瀑布、石角龙潭瀑布等水流充沛，飞泻而下时气势磅礴，白练垂空，水花四溅，在云雾映衬下，更显壮观，偶尔还会出现彩虹霞飞、白雾升腾的梦幻景象。人文与田园风光同样引人入胜。仙人石、锣鼓石等众多历史古迹历经岁月，古朴神秘，仿佛在默默讲述过往故事；崆峒宿集由原始农舍改造，古色古香，尽显乡村宁静美好。山脚下的村庄与周围山水云雾交融，层层叠叠的景观梯田若隐若现，充满诗意与田园气息。无论是沉醉于自然的鬼斧神工，还是探寻历史的足迹，亦或是享受田园的静谧，春天阴天的峰山国家森林公园，都能带来独特而难忘的体验。<br><strong>非遗展示：</strong><br>1.兴国山歌 —— 原生态的客家民歌，歌手即兴编词，高亢嘹亮的歌声回荡山间，歌词多反映劳动、爱情，可现场学唱，体验客家文化魅力。<br>2.赣南采茶戏 —— 演员身着鲜艳戏服，以 “三花”（花旦、小生、小丑）为主角，表演活泼诙谐，动作多模拟采茶劳作，在春天演绎充满生活气息的剧目。<br>3.于都唢呐公婆吹 —— 独特的双唢呐演奏形式，一高一低、一刚一柔，演奏曲目喜庆热烈，春日山林间，激昂的乐声传递浓浓民俗风情。'
            food_recommendations = '<br>1.赣南艾米果 —— 赣南艾米果是春日限定美味。采春季鲜嫩艾草焯水揉入糯米粉，外皮软糯泛着翠绿，透着淡淡草香。内馅分甜咸：甜馅以芝麻白糖拌花生碎，绵密香甜；咸馅用咸菜笋干同炒，咸鲜脆嫩。蒸时垫柚子叶增香，出锅后咬一口，软糯与清新交织，一口尝尽山野春日的温柔与丰饶。<br>2.峰山笋干烧肉 —— 选取峰山春季鲜笋晒制的笋干，搭配肥瘦相间的五花肉慢炖，笋干吸饱肉香，柔韧有嚼劲，五花肉肥而不腻，鲜香下饭。<br>3. 泥鳅钻豆腐 —— 活泥鳅与嫩豆腐同煮，受热的泥鳅钻入豆腐内，汤汁奶白醇厚，豆腐饱含鱼鲜，泥鳅肉质细嫩，鲜香爽滑，是赣南传统名菜。<br>4.客家酿豆腐 —— 豆腐挖洞填入肉馅，煎至金黄后炖煮，外皮焦香，内馅软嫩多汁，豆香与肉香交融，口感丰富，充满浓郁的客家风味<br>5.南酸枣糕 —— 以春季成熟的南酸枣为原料，经熬煮、晾晒制成，酸甜可口，软糯 Q 弹，富含果胶与维生素，是解腻又开胃的特色小食。'
            warm_tips = '<br>1.春季多雨，建议携带轻便的雨具，如折叠雨伞或雨衣，以防山间突发降雨，同时备上一件薄外套，抵御云雾缭绕时的微凉山风。徒步时穿防滑鞋，林间道路湿润易滑，注意脚下安全。<br>2.由于能见度较低，建议提前规划好路线，跟随景区标识前行，避免迷路。此外，云雾天气可能导致部分观景台视野受限，不妨放慢脚步，静心感受山林的朦胧之美，邂逅藏在氤氲雾气中的春日惊喜。'
            image_url = "https://so5.360tres.com/t01b8be92f2aef4cb0b.jpg"
        elif destination == '九江' and season == '冬季' and weather == '雪天':
            recommended_place = '庐山'
            scenic_features = '<br><strong>简介：</strong>庐山的冬天宛如被大自然精心雕琢的梦幻之境，银装素裹，美得动人心魄。从12月至次年2月，是庐山的最佳赏雪期 ，此时的庐山，呈现出诸多别具一格的景点特色。 含鄱口作为庐山雪天的明星打卡点，魅力非凡。站在这里，不仅能将鄱阳湖方向云雾缭绕、湖光雪色相互交融的美景尽收眼底，还能在冬日欣赏到绝美的日出日落。雪后的清晨或傍晚，阳光洒下，将雪地染成橙红、金黄，与山峦、云雾构成绚丽画卷 。 三叠泉的冬日景致同样震撼人心。平时气势恢宏的瀑布，在寒冬部分结冰，形成令人称奇的冰瀑景观。155米落差的悬崖和石壁上，层层叠叠地悬挂着各种冰柱、冰花，造就“悬崖百丈冰”的壮阔景观 。 漫步在牯岭街，仿佛踏入了童话世界。街道两旁欧式风格的建筑，在白雪的映衬下，红顶、白雪、五彩招牌相互交织，充满浪漫的异国情调 。 如琴湖也呈现出独特韵味。湖面上结着一层薄冰，周边群山被白雪覆盖，湖边树木挂满雾凇，与湖水相互辉映，构成如诗如画的仙境 。 小天池则以雾凇闻名，这里的雾凇堪称庐山一绝。树枝被晶莹剔透的冰晶包裹，在阳光照耀下闪烁五彩光芒，微风拂过，冰晶摇曳生姿。站在小天池山顶，能俯瞰庐山连绵山脉、错落树林被白雪覆盖的壮观全景。花径内，曲径通幽，花径亭顶覆满白霜，红色亭身于白雪中格外醒目，周边冰花形状各异，一片银白世界，充满诗意古韵 。庐山的冬天，每一处雪景都蕴含着独特魅力，令人流连忘返。<br><strong>非遗展示：</strong><br>1.星子金星砚制作技艺体验 —— 星子金星砚是庐山南麓星子县（现庐山市）的传统手工艺品，制作技艺传承千年。在冬日里，游客可亲手参与选石、设计、雕刻等工序，感受匠人匠心。成品砚台纹理如星点密布，质地细腻温润，兼具实用与收藏价值。<br>2.瑞昌剪纸艺术创作 —— 瑞昌剪纸以其独特的艺术风格入选非遗。在庐山周边的民俗活动中，游客可跟随剪纸艺人学习，用剪刀和红纸创作出花鸟鱼虫、吉祥图案等作品。一张红纸、一双巧手，在冬日里剪出浓浓的年味与传统文化气息。<br>3.湖口草龙编织体验 —— 湖口草龙以稻草为主要材料，经多道工序编织而成，是省级非遗。冬季闲暇时，参与草龙编织，学习传统编结技法，感受这项古老技艺的精妙，编织出的草龙造型生动，承载着民间祈福纳祥的美好寓意。'
            food_recommendations = '<br>1.石耳炖土鸡 —— 石耳炖土鸡是庐山冬日里的滋补珍品。取庐山岩壁间采摘的石耳，其形似耳状、质地柔韧，用温水泡发后洗净泥沙；再选散养土鸡剁块焯水，去除杂质。将两者一同入锅，加姜片、葱段慢火细炖两小时以上，直至鸡肉酥烂脱骨，石耳吸饱汤汁变得爽滑软嫩。掀开锅盖，浓郁的鲜香扑鼻而来，汤色澄黄透亮，油脂轻浮表面。舀一勺入口，土鸡的鲜甜与石耳的清润在舌尖交融，热汤顺着喉咙滑入胃中，驱散冬日寒意，每一口都是山林与田园的馈赠，暖身更暖心。<br>2.庐山云雾茶香鸭 —— 选用当地鸭子，融入庐山云雾茶独特茶香，经卤制入味，鸭肉紧实，茶香四溢，入口鲜香，回味悠长，是极具庐山特色的美味。<br>3. 鄱阳湖银鱼羹 —— 取鄱阳湖新鲜银鱼，搭配鸡蛋、香菇等食材熬煮成羹，银鱼鲜嫩无骨，羹汤浓稠顺滑，口感丰富，暖心又暖胃，是冬季餐桌上的佳品。<br>4.冬笋炒肉片 —— 冬季的庐山冬笋鲜嫩多汁，与肥瘦相间的肉片一同炒制，冬笋脆爽，肉片香嫩，咸淡适中，是一道家常却充满山林风味的美食。'
            warm_tips = '<br>1.冬天雪天前往庐山游玩，需做好全面准备。出行前务必关注景区实时天气预报和交通信息，确认道路通行状况，建议携带防滑冰爪，为鞋子套上“安全锁”，降低在冰雪路面滑倒风险；穿着上，选择防风防水的厚棉衣、保暖的羊毛袜与高帮防滑靴，戴上围巾、手套和耳罩，全方位抵御寒冷。<br>2.登山时遵循景区指定路线，勿擅自进入未开放区域，谨防积雪掩盖的危险地形。雪天光线经雪地反射强烈，记得佩戴墨镜，防止雪盲。拍摄美景时，注意为电子设备做好保暖措施，避免低温影响电池续航与设备性能。若遇大雾、大风等恶劣天气，及时到室内场所躲避，确保自身安全。'
            image_url = "https://img2.baidu.com/it/u=4207189309,698061271&fm=253&app=138&f=JPEG?w=615&h=500"
        else:
            recommended_place = '暂无推荐'
            scenic_features = '暂无特色信息'
            food_recommendations = '暂无美食推荐'
            warm_tips = '暂无温馨提示'
            image_url = 'https://picsum.photos/800/600'

        # 生成旅行计划 HTML 内容，设置图片为背景，文字为白色、居中、与页面两端间距 80px 且添加灰色蒙版
        trip_plan = f"""
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>旅行计划</title>
    <style>
        body {{
            background-image: url('{image_url}');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: white; /* 文字颜色设置为白色 */
            display: flex;
            flex-direction: column;
            
            
            min-height: 100vh;
            margin: 0;
            padding: 0 150px; /* 文字与页面两端间距设置为 80px */
            position: relative;
        }}
       .overlay {{
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(128, 128, 128, 0.5); /* 灰色蒙版，0.5 为透明度 */
        }}
       .content {{
            position: relative;
            z-index: 1;
        }}
        .content h2{{
            text-align:center;
        }}
       .content p {{
            text-align: left;
            width: fit-content;
            margin: 0 auto;
        }}
        .content p1 {{
            margin-bottom: 20px; /* 段落之间添加间距 */
        }}
    </style>
</head>
<body>
    <div class="overlay"></div>
    <div class="content">
        
            <h2 style="font-size: 36px;">推荐地点: {recommended_place}</h2>
        
        <p style="font-size: 20px;"><strong>景点特色</strong></p>
        <p style="font-size: 18px;">{scenic_features}</p>
        <p style="font-size: 20px;"><br><strong>推荐美食</strong></p>
        <p style="font-size: 18px;"> {food_recommendations}</p>
        <p style="font-size: 20px;"><br><strong>温馨提示</strong></p>
        <p style="font-size: 18px;":<br> {warm_tips}</p>
         <p style="font-size: 20px;"><br><strong>更多详情资讯请返回网页</strong></p>
    </div>
</body>
</html>
"""

        # 生成唯一的文件名
        file_name = f"{uuid.uuid4()}.html"
        current_dir = os.path.dirname(os.path.abspath(__file__))
        absolute_file_path = os.path.join(current_dir, file_name)

        # 将旅行计划写入文件
        with open(absolute_file_path, 'w', encoding='utf-8') as f:
            f.write(trip_plan)

        # 手动设置响应头并返回文件
        with open(absolute_file_path, 'rb') as f:
            file_content = f.read()
        response = Response(file_content, content_type='text/html; charset=utf-8')
        response.headers['Content-Disposition'] = f'attachment; filename={file_name}'
        return response

    except Exception as e:
        # 若出现异常，返回错误信息给前端
        return jsonify({"error": str(e)}), 500


if __name__ == '__main__':
    app.run(debug=True)